{
  "ignition": {
    "config": {},
    "security": {},
    "timeouts": {},
    "version": "2.2.0"
  },
  "networkd": {},
  "passwd": {
    "users": [
      {
        "name": "core",
        "sshAuthorizedKeys": [
          "<%= $id_rsa_pub %>"
        ]
      }
    ]
  },
  "storage": {"files": [
      {
        "filesystem": "root",
        "group": {},
        "path": "/etc/hostname",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $hostnamebase64 %>",
          "verification": {}
        },
        "mode": 420
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/home/core/deployconfig/config.json",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $configbase64 %>",
          "verification": {}
        },
        "mode": 420
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/home/core/deployconfig/secrets.json",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $secretbase64 %>",
          "verification": {}
        },
        "mode": 384
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/home/core/registry.auth",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $registryauthbase64 %>",
          "verification": {}
        },
        "mode": 384
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/usr/local/bin/stage2-containers.sh",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $stage2base64 %>",
          "verification": {}
        },
        "mode": 493
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/home/core/deployconfig/deploy.pem",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $sshprivkey %>",
          "verification": {}
        },
        "mode": 384
      },
      {
        "filesystem": "root",
        "group": {},
        "path": "/etc/sysconfig/network-scripts/ifcfg-ens192",
        "user": {},
        "contents": {
          "source": "data:text/plain;charset=utf-8;base64,<%= $ifcfgbase64 %>",
          "verification": {}
        },
        "mode": 420
      }
    ]
  },
  "systemd": {
    "units": [
<% if($useletsencrypt -eq "True" ) { %>      {
        "contents": "[Unit]\nDescription=Renews Cluster certs in letsencrypt\n[Service]\nType=oneshot\nExecStart=/usr/bin/sh -c 'podman run --entrypoint=/usr/local/letsencrypt/renew.sh -itv /home/core/deployconfig:/root:z -v /bin/oc:/usr/local/bin/oc:ro letsencrypt:<%= $imagetag %>'",
        "name": "renewcerts.service"
      },
      {
        "contents": "[Unit]\nDescription=Run Renew certs every 10mins\n[Timer]\nOnCalendar=daily\nRandomizedDelaySec=3600",
        "enabled": true,
        "name": "renewcerts.timer"
      },<% } %>
      {
        "contents": "[Unit]\nConditionFirstBoot=yes\n[Service]\nType=idle\nExecStart=/sbin/reboot\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "restart.service"
      },
      {
        "contents": "[Unit]\nAfter=console-login-helper-messages-issuegen.service\n[Service]\nType=oneshot\nExecStart=/usr/local/bin/stage2-containers.sh\n[Install]\nWantedBy=multi-user.target\n",
        "enabled": true,
        "name": "stage2-containers.service"
      }
    ]}
}
